import{c as f,w as M,o as T,r as F,V as U}from"./vue-yiQq_PH0.js";import{u as w}from"./useRequest-DUxWyDR5.js";import{e as V}from"./lodash-es-B1kh5og4.js";function x(D,m={}){const{manual:s,refreshDeps:h,defaultCurrent:S=1,defaultPageSize:z=10,...C}=m,r=w(D,{refreshDeps:[],...C,manual:!0}),p=f(()=>{var a;return((a=r.data.value)==null?void 0:a.total)??0}),i=f({get(){return(r.params.value[0]??{}).current??S},set(a){d(a)}}),n=f({get(){return(r.params.value[0]??{}).pageSize??z},set(a){b(a)}}),u=f(()=>{var a;const g=((a=r.data.value)==null?void 0:a.total)??0;return Math.ceil(g/n.value)});function v(a,g){let P=a<=0?1:a;const e=g<=0?1:g,l=Math.ceil(p.value/e);P>l&&(P=Math.max(1,l));const[t={},...c]=r.params.value??[];r.run({...t,current:P,pageSize:e},...c)}function d(a){v(a,n.value)}function b(a){v(i.value,a)}return V(h)||M(h,()=>{s||(m.refreshDepsAction?m.refreshDepsAction():d(1))}),T(()=>{if(!s){const[a={},...g]=r.params.value??[];r.run({...a,current:i.value,pageSize:n.value},...g)}}),{...r,pagination:{current:i,pageSize:n,total:p,totalPage:u,onChange:v,changeCurrent:d,changePageSize:b}}}function B(D,m={}){const{form:s,manual:h,onFinally:S,refreshDeps:z,refreshDepsAction:C,...r}=m,p=F(!1),i=F(!1),n=x(D,{...r,manual:!0,onFinally(...e){p.value=!1,i.value=!1,S&&S(...e)}});V(z)||M(z,()=>{h||(C?C():u({page:1}))});function u(e={}){const{run:l,pagination:t,params:c}=n,[o,y,...L]=c.value??[];l({...o??{},current:e.page??t.current.value,sorter:e.sorter??(o==null?void 0:o.sorter)??null,filters:e.filters??(o==null?void 0:o.filters)??{},pageSize:e.pageSize??t.pageSize.value},U(y??{}),...L)}function v(){var e,l;s?(l=(e=s.validate())==null?void 0:e.then(()=>{const{params:t}=n;t.value[1]=s.fieldsValue.value,i.value=!0,u({page:1})}))==null||l.catch(t=>t):(i.value=!0,u({page:1}))}function d(){if(s){s.restoreFieldsValue();const{params:e}=n;e.value[1]=s.fieldsValue.value}p.value=!0,u({page:1})}function b(e){u({page:e})}function a(e){const{total:l,current:t}=n.pagination,c=Math.ceil(l.value/e);let o=t.value;o>c&&(o=Math.max(1,c)),u({page:o,pageSize:e})}function g(e){u({filters:e})}function P(e){u({sorter:e})}return T(()=>{h||v()}),{...n,table:{onChange:u,tableProps:f(()=>{var c;const{data:e,loading:l,pagination:t}=n;return{remote:!0,loading:l.value,data:((c=e.value)==null?void 0:c.list)??[],pagination:{page:t.current.value,itemCount:t.total.value,pageSize:t.pageSize.value},onUpdatePage:b,onUpdateSorter:P,onUpdateFilters:g,onUpdatePageSize:a}})},search:{reset:d,submit:v,resetLoading:f(()=>p.value),searchLoading:f(()=>i.value),proSearchFormProps:f(()=>({loading:n.loading.value,searchButtonProps:{attrType:"button",loading:i.value,disabled:n.loading.value,onClick:v},resetButtonProps:{attrType:"button",loading:p.value,onClick:d}}))}}}export{B as u};
