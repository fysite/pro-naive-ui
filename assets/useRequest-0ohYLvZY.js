import{w as b,c as P,U as _,r as H,e as R,o as O,E as T,a8 as B}from"./vue-yiQq_PH0.js";import{e as I,w as W,t as L,l as N}from"./lodash-es-B1kh5og4.js";import{aO as c,aP as S}from"./index-B0ZkSKYK.js";const j=(o,{manual:r,refreshDeps:e=[],refreshDepsAction:s})=>I(e)?{}:(b(e,()=>{r||(s?s():o.refresh())}),{}),x=(o,{debounceWait:r,debounceLeading:e,debounceMaxWait:s,debounceTrailing:n})=>{let t,u;const i=P(()=>{const l={},a=c(e),h=c(s),f=c(n);return a!==void 0&&(l.leading=a),h!==void 0&&(l.maxWait=h),f!==void 0&&(l.trailing=f),l});return b(()=>[i.value,c(r)],(l,a,h)=>{const f=c(r);if(f){const{runAsync:g}=o;u=W(m=>{m()},f,i.value),o.runAsync=(...m)=>new Promise((p,y)=>{u(()=>{g(...m).then(p).catch(y)})}),t=()=>{u&&(u.cancel(),u=void 0),o.runAsync=g},h(t)}},{immediate:!0}),_(()=>t&&t()),{onCancel(){t&&t()}}},D=(o,{loadingDelay:r})=>{let e;function s(){e&&(clearTimeout(e),e=null)}return _(s),{onBefore(){s();const n=c(r);if(n)e=setTimeout(()=>{o.setState({loading:!0})},n);else return{};return{loading:!1}},onFinally(){s()},onCancel(){s()}}},F=!!(typeof window<"u"&&window.document&&window.document.createElement);function E(){return F?document.visibilityState!=="hidden":!0}const M=(o,{pollingInterval:r,pollingWhenHidden:e=!0,pollingErrorRetryCount:s=-1})=>{let n,t;const u=H(0),i=P(()=>({pollingInterval:c(r),pollingWhenHidden:c(e),pollingErrorRetryCount:c(s)}));function l(){n&&(clearTimeout(n),n=null),t&&t()}return _(l),{onBefore(){l()},onError(){u.value++},onSuccess(){u.value=0},onCancel(){l()},onFinally(){const{pollingInterval:a,pollingWhenHidden:h,pollingErrorRetryCount:f}=i.value;if(!a||a<=0){l();return}f===-1||u.value<=f?n=setTimeout(()=>{!h&&!E()?F&&(t=S(window,"visibilitychange",()=>{E()&&o.refresh()},!1)):o.refresh()},a):u.value=0}}};function q(){return F&&typeof navigator.onLine<"u"?navigator.onLine:!0}function U(o,r){let e=!1;return(...s)=>{e||(e=!0,o(...s),setTimeout(()=>{e=!1},r))}}const V=(o,{refreshOnWindowFocus:r,focusTimespan:e=5e3})=>{const s=[],n=P(()=>({focusTimespan:c(e),refreshOnWindowFocus:c(r)}));function t(){s.forEach(i=>i()),s.length=0}function u(i){const l=()=>{!E()||!q()||i()};s.push(S(window,"focus",l,!1),S(window,"visibilitychange",l,!1))}return b(n,()=>{t();const{focusTimespan:i,refreshOnWindowFocus:l}=n.value;if(F&&l){const a=U(o.refresh,i);u(()=>{a()})}},{immediate:!0}),{}},z=(o,{retryCount:r,retryInterval:e})=>{let s;const n=H(0),t=P(()=>({retryCount:c(r),retryInterval:c(e)}));function u(){s&&(clearTimeout(s),s=null)}return _(u),{onBefore(){u()},onSuccess(){n.value=0},onCancel(){n.value=0,u()},onError(){const{retryCount:i,retryInterval:l}=t.value;if(!i){u();return}if(n.value++,i===-1||n.value<=i){const a=l??Math.min(1e3*2**n.value,3e4);s=setTimeout(()=>{o.refresh()},a)}else n.value=0}}},G=(o,{throttleWait:r,throttleLeading:e,throttleTrailing:s})=>{let n,t;const u=P(()=>{const i={},l=c(e),a=c(s);return l!==void 0&&(i.leading=l),a!==void 0&&(i.trailing=a),i});return b(()=>[u.value,c(r)],(i,l,a)=>{const h=c(r);if(h){const{runAsync:f}=o;t=L(g=>{g()},h,u.value),o.runAsync=(...g)=>new Promise((m,p)=>{t(()=>{f(...g).then(m).catch(p)})}),n=()=>{t&&(t.cancel(),t=void 0),o.runAsync=f},a(n)}},{immediate:!0}),_(()=>n&&n()),{onCancel(){n&&n()}}};var J=Object.defineProperty,K=(o,r,e)=>r in o?J(o,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[r]=e,v=(o,r,e)=>K(o,typeof r!="symbol"?r+"":r,e);class Q{constructor(r,e,s={}){v(this,"count",0),v(this,"pluginImpls"),v(this,"state"),v(this,"setState",(n={})=>{Object.assign(this.state,n)}),v(this,"runPluginHandler",(n,...t)=>{const u=this.pluginImpls.map(i=>{var l;return(l=i[n])==null?void 0:l.call(i,...t)}).filter(Boolean);return Object.assign({},...u)}),v(this,"runAsync",async(...n)=>{var t,u,i,l,a,h,f,g,m,p;this.count+=1;const y=this.count,{stopNow:C=!1,returnNow:A=!1,...w}=this.runPluginHandler("onBefore",n);if(C)return new Promise(()=>{});if(this.setState({loading:!0,params:n,...w}),A)return Promise.resolve(w.data);(u=(t=this.options).onBefore)==null||u.call(t,n);try{const d=await this.service(...n);return y!==this.count?new Promise(()=>{}):(this.setState({data:d,loading:!1,error:void 0}),(l=(i=this.options).onSuccess)==null||l.call(i,d,n),this.runPluginHandler("onSuccess",d,n),(h=(a=this.options).onFinally)==null||h.call(a,n,d,void 0),y===this.count&&this.runPluginHandler("onFinally",n,d,void 0),d)}catch(d){if(y!==this.count)return new Promise(()=>{});throw this.setState({error:d,loading:!1}),(g=(f=this.options).onError)==null||g.call(f,d,n),this.runPluginHandler("onError",d,n),(p=(m=this.options).onFinally)==null||p.call(m,n,void 0,d),y===this.count&&this.runPluginHandler("onFinally",n,void 0,d),d}}),v(this,"run",(...n)=>{this.runAsync(...n).catch(t=>{this.options.onError||console.error(t)})}),v(this,"cancel",()=>{this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")}),v(this,"refresh",()=>{this.run(...this.state.params??[])}),v(this,"refreshAsync",()=>this.runAsync(...this.state.params??[])),v(this,"mutate",n=>{const t=N(n)?n(this.state.data):n;this.runPluginHandler("onMutate",t),this.setState({data:t})}),this.service=r,this.options=e,this.initState=s,this.pluginImpls=[],this.state=R({data:void 0,error:void 0,params:[],loading:!e.manual,...s})}}function X(o,r={},e=[]){const{manual:s=!1,...n}=r,t={manual:s,...n},u=e.map(w=>{var d;return(d=w==null?void 0:w.onInit)==null?void 0:d.call(w,t)}).filter(Boolean),i=new Q(o,t,Object.assign({},...u));i.options=t,i.pluginImpls=e.map(w=>w(i,t)),O(()=>{s||i.run()}),T(()=>{i.cancel()});const{data:l,error:a,params:h,loading:f}=B(i.state),{run:g,mutate:m,cancel:p,refresh:y,runAsync:C,refreshAsync:A}=i;return{data:l,error:a,params:h,loading:f,run:g,cancel:p,mutate:m,refresh:y,runAsync:C,refreshAsync:A}}function k(o,r,e){return X(o,r,[x,D,M,V,G,j,z])}export{k as u};
